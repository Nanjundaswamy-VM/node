'use strict';var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));var
Query_handler = /*#__PURE__*/function () {function Query_handler() {(0, _classCallCheck2["default"])(this, Query_handler);}(0, _createClass2["default"])(Query_handler, [{ key: "save_entry", value: function save_entry(

    element) {
      return new Promise(function (resolve, reject) {
        // save the order
        element.save(function (err, data) {
          if (err) {
            reject(err);
          } else {
            resolve(data);
          }
        });
      });
    } }, { key: "get_entry_by_id", value: function get_entry_by_id(

    element, id) {
      return new Promise(function (resolve, reject) {
        // get the entry
        element.findById(id, function (err, data) {
          if (err) {
            reject(err);
          } else {
            resolve(data);
          }
        });
      });
    } }, { key: "get_ids_by_city", value: function get_ids_by_city(

    element, value, fields) {
      return new Promise(function (resolve, reject) {
        // get the entry with specified fields
        element.find({ city: new RegExp('^' + value + '$', 'i') }, fields, function (err, data) {
          if (err) {
            reject(err);
          } else {
            resolve(data);
          }
        });
      });
    } }, { key: "update_entry", value: function update_entry(
    element, id, fields) {
      return new Promise(function (resolve, reject) {
        // update the entry
        element.updateOne({ '_id': Object(id) }, fields, function (err, data) {
          if (err) {
            reject(err);
          } else {
            resolve(data);
          }
        });
      });
    } }, { key: "find_entry", value: function find_entry(

    element, req_data) {
      return new Promise(function (resolve, reject) {
        var queryObj = {};
        if (req_data.cuisine) {
          queryObj.cuisines = { $eq: req_data.cuisine };
        }

        if (req_data.name) {
          queryObj.name = { $eq: req_data.name };
        }
        if (req_data.ratings) {
          queryObj.ratings = { $gte: req_data.ratings };
        }

        if (req_data.budget) {
          queryObj.budget = { $lte: req_data.budget };
        }

        if (req_data.location) {
          queryObj.city = { $eq: req_data.location };
        }
        if (req_data.menu) {
          queryObj.menu = { $elemMatch: { itemname: req_data.menu } };
        }
        if (req_data.distance) {
          var _long = req_data.distance[0];
          var latt = req_data.distance[1];
          queryObj.location = {
            $near: {
              $maxDistance: 10000,
              $geometry: {
                type: "Point",
                coordinates: [_long, latt] } } };



        }
        console.log(queryObj);
        element.find({ $and: [queryObj] }, function (err, docs) {
          if (err) {
            reject(err);
          } else {
            console.log(docs);
            resolve(docs);
          }
        });

      });
    } }]);return Query_handler;}();


var query_obj = new Query_handler();
module.exports = query_obj;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9hcHAvbGliL3F1ZXJ5X2hhbmRsZXIuanMiXSwibmFtZXMiOlsiUXVlcnlfaGFuZGxlciIsImVsZW1lbnQiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsInNhdmUiLCJlcnIiLCJkYXRhIiwiaWQiLCJmaW5kQnlJZCIsInZhbHVlIiwiZmllbGRzIiwiZmluZCIsImNpdHkiLCJSZWdFeHAiLCJ1cGRhdGVPbmUiLCJPYmplY3QiLCJyZXFfZGF0YSIsInF1ZXJ5T2JqIiwiY3Vpc2luZSIsImN1aXNpbmVzIiwiJGVxIiwibmFtZSIsInJhdGluZ3MiLCIkZ3RlIiwiYnVkZ2V0IiwiJGx0ZSIsImxvY2F0aW9uIiwibWVudSIsIiRlbGVtTWF0Y2giLCJpdGVtbmFtZSIsImRpc3RhbmNlIiwibG9uZyIsImxhdHQiLCIkbmVhciIsIiRtYXhEaXN0YW5jZSIsIiRnZW9tZXRyeSIsInR5cGUiLCJjb29yZGluYXRlcyIsImNvbnNvbGUiLCJsb2ciLCIkYW5kIiwiZG9jcyIsInF1ZXJ5X29iaiIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiJBQUFBLGE7QUFDTUEsYTs7QUFFTUMsSUFBQUEsTyxFQUFTO0FBQ2pCLGFBQU8sSUFBSUMsT0FBSixDQUFZLFVBQUNDLE9BQUQsRUFBVUMsTUFBVixFQUFxQjtBQUNwQztBQUNBSCxRQUFBQSxPQUFPLENBQUNJLElBQVIsQ0FBYSxVQUFTQyxHQUFULEVBQWFDLElBQWIsRUFBbUI7QUFDNUIsY0FBSUQsR0FBSixFQUFTO0FBQ0xGLFlBQUFBLE1BQU0sQ0FBQ0UsR0FBRCxDQUFOO0FBQ0gsV0FGRCxNQUVPO0FBQ0hILFlBQUFBLE9BQU8sQ0FBQ0ksSUFBRCxDQUFQO0FBQ0g7QUFDSixTQU5EO0FBT0gsT0FUTSxDQUFQO0FBVUgsSzs7QUFFZ0JOLElBQUFBLE8sRUFBUU8sRSxFQUFJO0FBQ3pCLGFBQU8sSUFBSU4sT0FBSixDQUFZLFVBQUNDLE9BQUQsRUFBVUMsTUFBVixFQUFxQjtBQUNwQztB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QUFxQjtBQUNwQixjQUFJQyxLQUFJLEdBQUVmLFFBQVEsQ0FBQ2MsUUFBVCxDQUFrQixDQUFsQixDQUFWO0FBQ0EsY0FBSUUsSUFBSSxHQUFFaEIsUUFBUSxDQUFDYyxRQUFULENBQWtCLENBQWxCLENBQVY7QUFDQWIsVUFBQUEsUUFBUSxDQUFDUyxRQUFULEdBQW9CO0FBQ2xCTyxZQUFBQSxLQUFLLEVBQUU7QUFDVEMsY0FBQUEsWUFBWSxFQUFFLEtBREw7QUFFVEMsY0FBQUEsU0FBUyxFQUFFO0FBQ1ZDLGdCQUFBQSxJQUFJLEVBQUUsT0FESTtBQUVWQyxnQkFBQUEsV0FBVyxFQUFFLENBQUNOLEtBQUQsRUFBT0MsSUFBUCxDQUZILEVBRkYsRUFEVyxFQUFwQjs7OztBQVNNO0FBQ0RNLFFBQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFZdEIsUUFBWjtBQUNBakIsUUFBQUEsT0FBTyxDQUFDVyxJQUFSLENBQWEsRUFBRTZCLElBQUksRUFBRyxDQUFDdkIsUUFBRCxDQUFULEVBQWIsRUFBbUMsVUFBVVosR0FBVixFQUFlb0MsSUFBZixFQUFxQjtBQUNwRCxjQUFJcEMsR0FBSixFQUFTO0FBQ0xGLFlBQUFBLE1BQU0sQ0FBQ0UsR0FBRCxDQUFOO0FBQ0gsV0FGRCxNQUVLO0FBQ0RpQyxZQUFBQSxPQUFPLENBQUNDLEdBQVIsQ0FBWUUsSUFBWjtBQUNBdkMsWUFBQUEsT0FBTyxDQUFDdUMsSUFBRCxDQUFQO0FBQ0g7QUFDSixTQVBEOztBQVNILE9BOUNNLENBQVA7QUErQ0gsSzs7O0FBR0QsSUFBTUMsU0FBUyxHQUFHLElBQUkzQyxhQUFKLEVBQWxCO0FBQ0E0QyxNQUFNLENBQUNDLE9BQVAsR0FBaUJGLFNBQWpCIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xyXG5jbGFzcyBRdWVyeV9oYW5kbGVyIHtcclxuICAgIFxyXG4gc2F2ZV9lbnRyeShlbGVtZW50KSB7XHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICAgIC8vIHNhdmUgdGhlIG9yZGVyXHJcbiAgICAgICAgZWxlbWVudC5zYXZlKGZ1bmN0aW9uKGVycixkYXRhKSB7XHJcbiAgICAgICAgICAgIGlmIChlcnIpIHtcclxuICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZShkYXRhKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pXHJcbiAgICB9KVxyXG59XHJcblxyXG4gZ2V0X2VudHJ5X2J5X2lkKGVsZW1lbnQsaWQpIHtcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgICAgLy8gZ2V0IHRoZSBlbnRyeVxyXG4gICAgICAgIGVsZW1lbnQuZmluZEJ5SWQoaWQsIGZ1bmN0aW9uKGVyciwgZGF0YSkge1xyXG4gICAgICAgICAgICBpZiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgICAgICByZXNvbHZlKGRhdGEpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KVxyXG59XHJcblxyXG5nZXRfaWRzX2J5X2NpdHkoZWxlbWVudCx2YWx1ZSxmaWVsZHMpIHtcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgICAgLy8gZ2V0IHRoZSBlbnRyeSB3aXRoIHNwZWNpZmllZCBmaWVsZHNcclxuICAgICAgICBlbGVtZW50LmZpbmQoeyBjaXR5Om5ldyBSZWdFeHAoJ14nICt2YWx1ZSArICckJywgJ2knKX0sZmllbGRzLGZ1bmN0aW9uKGVyciwgZGF0YSkge1xyXG4gICAgICAgICAgICBpZiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgICAgICByZXNvbHZlKGRhdGEpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KVxyXG59XHJcbiB1cGRhdGVfZW50cnkoZWxlbWVudCxpZCxmaWVsZHMpIHtcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgICAgLy8gdXBkYXRlIHRoZSBlbnRyeVxyXG4gICAgICAgIGVsZW1lbnQudXBkYXRlT25lKHsgJ19pZCc6IE9iamVjdChpZCkgfSwgZmllbGRzLCBmdW5jdGlvbihlcnIsIGRhdGEpIHtcclxuICAgICAgICAgICAgaWYgKGVycikge1xyXG4gICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZShkYXRhKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfSlcclxufVxyXG5cclxuZmluZF9lbnRyeShlbGVtZW50LHJlcV9kYXRhKSB7XHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IHF1ZXJ5T2JqID0ge31cclxuICAgICAgICBpZihyZXFfZGF0YS5jdWlzaW5lKXtcclxuICAgICAgICAgICAgcXVlcnlPYmouY3Vpc2luZXMgPSB7ICRlcTogcmVxX2RhdGEuY3Vpc2luZX1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmKHJlcV9kYXRhLm5hbWUpe1xyXG4gICAgICAgICAgICBxdWVyeU9iai5uYW1lID0geyAkZXE6IHJlcV9kYXRhLm5hbWV9IDtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYocmVxX2RhdGEucmF0aW5ncyl7XHJcbiAgICAgICAgICAgIHF1ZXJ5T2JqLnJhdGluZ3MgPSB7ICRndGU6IHJlcV9kYXRhLnJhdGluZ3N9IDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmKHJlcV9kYXRhLmJ1ZGdldCl7XHJcbiAgICAgICAgICAgIHF1ZXJ5T2JqLmJ1ZGdldCA9IHsgJGx0ZTogcmVxX2RhdGEuYnVkZ2V0fSA7XHJcbiAgICAgICAgfVxyXG5cdFx0XHJcblx0XHRpZihyZXFfZGF0YS5sb2NhdGlvbil7XHJcbiAgICAgICAgICAgIHF1ZXJ5T2JqLmNpdHkgPSB7ICRlcTogcmVxX2RhdGEubG9jYXRpb259IDtcclxuICAgICAgICB9XHJcblx0XHRpZihyZXFfZGF0YS5tZW51KXtcclxuICAgICAgICAgICAgcXVlcnlPYmoubWVudSA9ICB7ICRlbGVtTWF0Y2g6IHsgaXRlbW5hbWU6IHJlcV9kYXRhLm1lbnUgfSB9IDtcclxuICAgICAgICB9XHJcblx0XHRpZihyZXFfZGF0YS5kaXN0YW5jZSl7XHJcblx0XHQgbGV0IGxvbmcgPXJlcV9kYXRhLmRpc3RhbmNlWzBdXHJcblx0XHQgbGV0IGxhdHQgPXJlcV9kYXRhLmRpc3RhbmNlWzFdXHJcblx0XHQgcXVlcnlPYmoubG9jYXRpb24gPSB7XHJcblx0XHQgICAkbmVhcjoge1xyXG5cdFx0XHQkbWF4RGlzdGFuY2U6IDEwMDAwLFxyXG5cdFx0XHQkZ2VvbWV0cnk6IHtcclxuXHRcdFx0IHR5cGU6IFwiUG9pbnRcIixcclxuXHRcdFx0IGNvb3JkaW5hdGVzOiBbbG9uZywgbGF0dF1cclxuXHRcdFx0fVxyXG5cdFx0ICAgfVxyXG5cdFx0ICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnNvbGUubG9nKHF1ZXJ5T2JqKTtcclxuICAgICAgICBlbGVtZW50LmZpbmQoeyAkYW5kIDogW3F1ZXJ5T2JqXX0sIGZ1bmN0aW9uIChlcnIsIGRvY3MpIHtcclxuICAgICAgICAgICAgaWYgKGVycikge1xyXG4gICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coZG9jcyk7XHJcbiAgICAgICAgICAgICAgICByZXNvbHZlKGRvY3MpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgXHJcbiAgICB9KVxyXG59XHJcblxyXG59XHJcbmNvbnN0IHF1ZXJ5X29iaiA9IG5ldyBRdWVyeV9oYW5kbGVyKCk7XHJcbm1vZHVsZS5leHBvcnRzID0gcXVlcnlfb2JqOyJdfQ==